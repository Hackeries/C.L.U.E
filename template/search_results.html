{% extends 'nav.html' %}
{% load static %}
{% block content %}
<div class="container py-4">
  <h3>Search events</h3>
  <form class="row g-2 mb-3" method="get">
    <div class="col-md-4">
      <input type="text" class="form-control" name="q" placeholder="Event name" value="{{ query }}">
    </div>
    <div class="col-md-3">
      <input type="date" class="form-control" name="date" value="{{ date }}">
    </div>
    <div class="col-md-3">
      <select class="form-select" name="department">
        <option value="">All departments</option>
        {% for d in departments %}
        <option value="{{ d.department_name }}" {% if department == d.department_name %}selected{% endif %}>{{ d.department_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <select class="form-select" name="type">
        <option value="">All types</option>
        <option value="club" {% if type == 'club' %}selected{% endif %}>Club</option>
        <option value="department" {% if type == 'department' %}selected{% endif %}>Department</option>
      </select>
    </div>
    <div class="col-12">
      <button class="btn btn-primary">Search</button>
    </div>
  </form>

  <div class="row">
    {% if club_events %}
    <h5 class="mt-3">Club Events</h5>
    {% for e in club_events %}
    <div class="col-md-6 mb-3">
      <div class="card h-100">
        {% if e.event_poster %}<img src="{{ e.event_poster.url }}" class="card-img-top" style="max-height:200px;object-fit:cover;">{% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ e.event_name }}</h5>
          <p class="card-text mb-1"><strong>Department:</strong> {{ e.department_name.department_name }}</p>
          <p class="card-text mb-1"><strong>Date:</strong> {{ e.event_start_date }}{% if e.event_end_date and e.event_end_date != e.event_start_date %} - {{ e.event_end_date }}{% endif %}</p>
          <p class="card-text mb-1"><strong>Venue:</strong> {{ e.event_venue }}</p>
        </div>
      </div>
    </div>
    {% empty %}
    <p>No club events found.</p>
    {% endfor %}
    {% endif %}
  </div>

  <div class="row">
    {% if dept_events %}
    <h5 class="mt-4">Department Events</h5>
    {% for e in dept_events %}
    <div class="col-md-6 mb-3">
      <div class="card h-100">
        {% if e.event_poster %}<img src="{{ e.event_poster.url }}" class="card-img-top" style="max-height:200px;object-fit:cover;">{% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ e.event_name }}</h5>
          <p class="card-text mb-1"><strong>Department:</strong> {{ e.department_name.department_name }}</p>
          <p class="card-text mb-1"><strong>Date:</strong> {{ e.event_start_date }}{% if e.event_end_date and e.event_end_date != e.event_start_date %} - {{ e.event_end_date }}{% endif %}</p>
          <p class="card-text mb-1"><strong>Venue:</strong> {{ e.event_venue }}</p>
        </div>
      </div>
    </div>
    {% empty %}
    <p>No department events found.</p>
    {% endfor %}
    {% endif %}
  </div>
</div>
{% endblock %}
